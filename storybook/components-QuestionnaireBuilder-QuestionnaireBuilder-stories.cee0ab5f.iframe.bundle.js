"use strict";(self.webpackChunkwingman_fe=self.webpackChunkwingman_fe||[]).push([[729],{"./lib/components/QuestionnaireBuilder/QuestionnaireBuilder.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{QuestionnaireBuilder:()=>QuestionnaireBuilder_stories_QuestionnaireBuilder,default:()=>QuestionnaireBuilder_stories});var Box=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Box/Box.mjs"),Card=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Card/Card.mjs"),Stack=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Stack/Stack.mjs"),Columns=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Columns/Columns.mjs"),Column=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Column/Column.mjs"),Divider=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Divider/Divider.mjs"),Heading=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Heading/Heading.mjs"),react=__webpack_require__("../node_modules/.pnpm/react@18.3.1/node_modules/react/index.js");var Text=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Text/Text.mjs"),Textarea=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Textarea/Textarea.mjs");const componentId=function(prefix){for(var _len=arguments.length,rawValues=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)rawValues[_key-1]=arguments[_key];return[prefix,...rawValues.map(str=>{let value="";for(let i=0;i<str.length;i++)value+=str.charCodeAt(i).toString(36);return value})].join("-")};var jsx_runtime=__webpack_require__("../node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js");const components_FreeText=_ref=>{let{value,setValue,title}=_ref;return(0,jsx_runtime.jsxs)(Stack.B,{space:"medium",children:[(0,jsx_runtime.jsx)(Text.E,{id:componentId("free-text-label",title),weight:"strong",children:title}),(0,jsx_runtime.jsx)(Textarea.T,{"aria-labelledby":componentId("free-text-label",title),id:componentId("free-text",title),value,onChange:event=>{setValue(event.currentTarget.value)}})]})};var Checkbox=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Checkbox/Checkbox.mjs");const components_MultiSelect=_ref=>{let{options,value,setValue,id,title}=_ref;const onChange=choice=>event=>{if(event.currentTarget.checked){const newValues=[...value||[],choice];setValue(newValues)}else{const newValues=value.filter(val=>val!==choice);setValue(newValues)}};return(0,jsx_runtime.jsxs)(Stack.B,{space:"medium",children:[(0,jsx_runtime.jsx)(Text.E,{weight:"strong",children:title}),options.map(choice=>(0,jsx_runtime.jsx)(Checkbox.S,{checked:value&&value.includes(choice),id:componentId("multi-select",id,choice),label:choice,reserveMessageSpace:!1,onChange:onChange(choice)},choice))]})};var _IconNewWindow,TextLink=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/TextLink/TextLink.mjs"),IconNewWindow=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/icons/IconNewWindow/IconNewWindow.mjs");const PrivacyConsent=_ref=>{let{privacy}=_ref;const[checked,setChecked]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(Stack.B,{space:"medium",children:[(0,jsx_runtime.jsx)(Checkbox.S,{id:"privacyConsentCheckbox",label:privacy.descriptionHtml??"Do you agree to the privacy policy?",onChange:()=>setChecked(!checked),checked}),(0,jsx_runtime.jsx)(Text.E,{children:(0,jsx_runtime.jsxs)(TextLink.Yq,{hitArea:"large",href:privacy.privacyPolicyUrl.url,children:["Click here to view ",_IconNewWindow||(_IconNewWindow=(0,jsx_runtime.jsx)(IconNewWindow.Q,{}))]})})]})};var Dropdown=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Dropdown/Dropdown.mjs"),RadioGroup=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/RadioGroup/RadioGroup.mjs"),RadioItem=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/RadioGroup/RadioItem.mjs");const components_SingleSelect=_ref=>{let{choices,value,setValue,id,title}=_ref;const onChange=event=>{setValue(event.currentTarget.value)};return(0,jsx_runtime.jsxs)(Stack.B,{space:"medium",children:[(0,jsx_runtime.jsx)(Text.E,{id:componentId("single-select-label",id),weight:"strong",children:title}),choices.length>5?(0,jsx_runtime.jsx)(Dropdown.m,{"aria-labelledby":componentId("single-select-label",id),id:componentId("single-select",id),onChange,value,children:choices.map(choice=>(0,jsx_runtime.jsx)("option",{children:choice},choice))}):(0,jsx_runtime.jsx)(RadioGroup.z,{"aria-labelledby":componentId("single-select-label",id),id:componentId("single-select",id),onChange,value,children:choices.map(choice=>(0,jsx_runtime.jsx)(RadioItem.h,{label:choice,value:choice},choice))})]})},createUpdateFieldAction=(fieldId,dispatch)=>newValue=>dispatch({type:"UPDATE_FIELD",fieldId,newValue}),formStateReducer=(state,action)=>{if("UPDATE_FIELD"===action.type){return{...state,[action.fieldId]:action.newValue}}},QuestionnaireForm=props=>{const formComponents="Form"!==props.type?props.components.map(component=>"PrivacyConsent"===component.componentTypeCode?(component=>({componentTypeCode:"PrivacyConsent",privacyPolicyUrl:component.privacyPolicyUrl,value:component.id.value,descriptionHtml:component.descriptionHtml||""}))(component):(component=>({componentTypeCode:"Question",questionHtml:component.questionHtml,responseChoice:component.responseChoice?component.responseChoice.map(r=>({text:r.text,value:r.id.value,preferredIndicator:r.preferredIndicator})):[],responseTypeCode:component.responseTypeCode,value:component.id.value}))(component)):props.components;const[state,dispatch]=(0,react.useReducer)(formStateReducer,{}),questions=formComponents.filter(fc=>"Question"===fc.componentTypeCode).map((component,index)=>((component,index,state,dispatch)=>{switch(component.responseTypeCode){case"SingleSelect":return(0,jsx_runtime.jsx)(components_SingleSelect,{value:state[component.value],setValue:createUpdateFieldAction(component.value,dispatch),choices:component.responseChoice.map(choice=>choice.text),id:component.value,title:`${index+1}. ${component.questionHtml}`},component.value);case"MultiSelect":return(0,jsx_runtime.jsx)(components_MultiSelect,{value:state[component.value],setValue:createUpdateFieldAction(component.value,dispatch),options:component.responseChoice.map(choice=>choice.text),id:component.value,title:`${index+1}. ${component.questionHtml}`},component.value);case"FreeText":return(0,jsx_runtime.jsx)(components_FreeText,{value:state[component.value],setValue:createUpdateFieldAction(component.value,dispatch),title:`${index+1}. ${component.questionHtml}`},component.value)}})(component,index,state,dispatch)),privacyComponent=formComponents.find(fc=>"PrivacyConsent"===fc.componentTypeCode),privacy=privacyComponent?(component=privacyComponent,(0,jsx_runtime.jsx)(PrivacyConsent,{privacy:component},component.value)):null;var component;return(0,jsx_runtime.jsxs)(Stack.B,{space:"large",children:[questions,privacy]})};var QuestionnaireQueryOutput=__webpack_require__("./lib/components/QuestionnaireQueryOutput/QuestionnaireQueryOutput.tsx"),TextLinkButton=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/TextLinkButton/TextLinkButton.mjs"),IconAdd=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/icons/IconAdd/IconAdd.mjs"),Alert=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Alert/Alert.mjs"),constants=__webpack_require__("./lib/private/questionnaires/constants.ts"),TextField=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/TextField/TextField.mjs"),Actions=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Actions/Actions.mjs"),Button=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Button/Button.mjs"),index_esm=__webpack_require__("../node_modules/.pnpm/react-hook-form@7.64.0_react@18.3.1/node_modules/react-hook-form/dist/index.esm.mjs");const createResolver=fn=>values=>{const errors={};return fn(values,errors),Object.keys(errors).length?{errors,values:{}}:{errors:{},values}},createAddSelectQuestionAction=questionType=>dispatch=>(questionText,options)=>{const responseChoice=options.map(_ref=>{let{text,preferredIndicator}=_ref;return{text,preferredIndicator,value:text.replace(/ /g,"").toLowerCase()}}),newValue={value:window.crypto.randomUUID(),componentTypeCode:"Question",questionHtml:questionText,responseTypeCode:questionType,responseChoice};dispatch({type:"ADD_COMPONENT",fieldId:newValue.value,newValue})},createEditSelectQuestionAction=questionType=>dispatch=>(questionId,questionText,options)=>{const responseChoice=options.map(_ref2=>{let{text,preferredIndicator}=_ref2;return{text,preferredIndicator,value:text.replace(/ /g,"").toLowerCase()}});dispatch({type:"EDIT_COMPONENT",newValue:{value:questionId,questionHtml:questionText,responseTypeCode:questionType,responseChoice,componentTypeCode:"Question"}})},actionCreators={add:{FreeText:dispatch=>questionText=>{const newValue={value:window.crypto.randomUUID(),questionHtml:questionText,responseTypeCode:"FreeText",componentTypeCode:"Question"};dispatch({type:"ADD_COMPONENT",fieldId:newValue.value,newValue})},SingleSelect:createAddSelectQuestionAction("SingleSelect"),MultiSelect:createAddSelectQuestionAction("MultiSelect"),PrivacyConsent:dispatch=>(descriptionHtml,url)=>{const newValue={value:window.crypto.randomUUID(),privacyPolicyUrl:{url},descriptionHtml,componentTypeCode:"PrivacyConsent"};dispatch({type:"ADD_COMPONENT",fieldId:newValue.value,newValue})}},update:{FreeText:dispatch=>(questionId,questionText)=>{dispatch({type:"EDIT_COMPONENT",newValue:{value:questionId,questionHtml:questionText,responseTypeCode:"FreeText",componentTypeCode:"Question"}})},SingleSelect:createEditSelectQuestionAction("SingleSelect"),MultiSelect:createEditSelectQuestionAction("MultiSelect"),PrivacyConsent:dispatch=>(questionId,descriptionHtml,url)=>{dispatch({type:"EDIT_COMPONENT",newValue:{value:questionId,privacyPolicyUrl:{url},descriptionHtml,componentTypeCode:"PrivacyConsent"}})}},delete:dispatch=>questionId=>{dispatch({type:"DELETE_COMPONENT",fieldId:questionId})},import:dispatch=>value=>{dispatch({type:"IMPORT_COMPONENTS",newValue:value})}},StateContext=react.createContext({state:[],dispatch:()=>{}}),splitArrayAt=(inputArray,index)=>{const beforeItem=inputArray.slice(0,index),afterItem=inputArray.slice(index+1);return{beforeItem,item:inputArray[index],afterItem}},formBuilderStateReducer=(state,action)=>{switch(action.type){case"ADD_COMPONENT":return[...state,action.newValue];case"DELETE_COMPONENT":const itemIndex=state.findIndex(_ref4=>{let{value}=_ref4;return value===action.fieldId}),{beforeItem,afterItem}=splitArrayAt(state,itemIndex);return[...beforeItem,...afterItem];case"EDIT_COMPONENT":return(item=>{const itemEditIndex=state.findIndex(_ref3=>{let{value}=_ref3;return value===item.value}),{beforeItem,afterItem}=splitArrayAt(state,itemEditIndex);return[...beforeItem,item,...afterItem]})(action.newValue);case"IMPORT_COMPONENTS":return action.newValue}};var _Button;const blankFormValues={value:"",privacyPolicyUrl:{url:""},descriptionHtml:""},resolver=createResolver((values,errors)=>{values.description.trim()||(errors.description={type:"required",message:"Enter a description"}),(str=>{try{const url=new URL(str);return["http:","https:"].includes(url.protocol)}catch{return!1}})(values.url)||(errors.url={type:"validate",message:"Enter a valid HTTP(S) URL"})}),NewPrivacyConsentForm=_ref=>{let{hideForm,initialValues=blankFormValues}=_ref;const{dispatch}=(0,react.useContext)(StateContext),{control,formState:{errors},handleSubmit}=(0,index_esm.mN)({resolver});return(0,jsx_runtime.jsx)("form",{onSubmit:handleSubmit(formData=>{const{description,url}=formData;if(initialValues.value){(0,actionCreators.update.PrivacyConsent)(dispatch)(initialValues.value,description,url)}else{(0,actionCreators.add.PrivacyConsent)(dispatch)(description,url)}hideForm()}),children:(0,jsx_runtime.jsxs)(Stack.B,{space:"large",children:[(0,jsx_runtime.jsx)(Box.l,{children:(0,jsx_runtime.jsxs)(Heading.D,{level:"3",children:[initialValues.value?"Edit":"New"," privacy consent"]})}),(0,jsx_runtime.jsx)(index_esm.xI,{render:_ref2=>{var _errors$url;let{field}=_ref2;return(0,jsx_runtime.jsx)(TextField.A,{...field,id:"url",label:"URL",message:null===(_errors$url=errors.url)||void 0===_errors$url?void 0:_errors$url.message,onChange:event=>field.onChange(event.currentTarget.value),tone:errors.url?"critical":void 0})},control,name:"url",defaultValue:initialValues.privacyPolicyUrl.url}),(0,jsx_runtime.jsx)(index_esm.xI,{render:_ref3=>{var _errors$description;let{field}=_ref3;return(0,jsx_runtime.jsx)(TextField.A,{...field,id:"description",label:"Description",message:null===(_errors$description=errors.description)||void 0===_errors$description?void 0:_errors$description.message,onChange:event=>field.onChange(event.currentTarget.value),tone:errors.description?"critical":void 0})},control,name:"description",defaultValue:initialValues.descriptionHtml||"Do you agree to the privacy policy?"}),(0,jsx_runtime.jsx)(Box.l,{children:(0,jsx_runtime.jsxs)(Actions.E,{children:[_Button||(_Button=(0,jsx_runtime.jsx)(Button.$n,{type:"submit",children:"Save"})),(0,jsx_runtime.jsx)(Button.$n,{onClick:hideForm,variant:"transparent",children:"Cancel"})]})})]})})};var _IconClear,FieldMessage=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/FieldMessage/FieldMessage.mjs"),IconClear=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/icons/IconClear/IconClear.mjs"),CheckboxStandalone=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Checkbox/CheckboxStandalone.mjs");const DisplayOption=_ref=>{let{text,setPreferred,removeItem,preferredIndicator}=_ref;return(0,jsx_runtime.jsx)(Stack.B,{space:"small",children:(0,jsx_runtime.jsxs)(Columns.e,{alignY:"center",space:"small",children:[(0,jsx_runtime.jsx)(Column.V,{width:"content",children:(0,jsx_runtime.jsx)(Text.E,{children:(0,jsx_runtime.jsx)(TextLinkButton.W,{hitArea:"large",onClick:removeItem,children:_IconClear||(_IconClear=(0,jsx_runtime.jsx)(IconClear.n,{tone:"link"}))})})}),(0,jsx_runtime.jsx)(Column.V,{children:(0,jsx_runtime.jsx)(Text.E,{children:text})}),(0,jsx_runtime.jsx)(Column.V,{width:"content",children:(0,jsx_runtime.jsx)(CheckboxStandalone.p,{"aria-label":"Set option as preferred",checked:preferredIndicator,id:`questionnaireBuilderQuestionOptionPreferredIndicator-${text}`,onChange:event=>setPreferred(text,event.currentTarget.checked)})})]})})};var _Text,_Divider;const SelectOptions_splitArrayAt=(inputArray,index)=>{const beforeItem=inputArray.slice(0,index),afterItem=inputArray.slice(index+1);return{beforeItem,item:inputArray[index],afterItem}},SelectOptions=_ref=>{var _errors$option;let{options,setOptionList}=_ref;const resolver=(0,react.useMemo)(()=>createResolver((values,errors)=>{values.option?options.some(option=>option.value===values.option)&&(errors.option={type:"validate",message:"This option already exists"}):errors.option={type:"required",message:"Enter an option"}}),[options]),{control,formState:{errors},handleSubmit,reset,setValue}=(0,index_esm.mN)({defaultValues:{option:""},resolver}),optionInputRef=(0,react.useRef)(null),setPreferred=(itemText,newStatus)=>{const itemIndex=options.findIndex(_ref2=>{let{text}=_ref2;return text===itemText}),{beforeItem,afterItem,item}=SelectOptions_splitArrayAt(options,itemIndex);setOptionList([...beforeItem,{text:item.text,preferredIndicator:newStatus,value:item.value},...afterItem])};return(0,jsx_runtime.jsxs)(Stack.B,{space:"medium",children:[options.length>=99?_Text||(_Text=(0,jsx_runtime.jsxs)(Text.E,{tone:"secondary",children:["You can’t provide more than ",99," options."]})):(0,jsx_runtime.jsxs)(Stack.B,{space:"small",children:[(0,jsx_runtime.jsxs)(Columns.e,{alignY:"bottom",space:"small",children:[(0,jsx_runtime.jsx)(Column.V,{children:(0,jsx_runtime.jsx)(index_esm.xI,{control,name:"option",render:_ref4=>{let{field}=_ref4;return(0,jsx_runtime.jsx)(TextField.A,{...field,id:"questionnaireBuilderAddOption",label:"Options",onChange:event=>field.onChange(event.currentTarget.value),onClear:()=>setValue("option",""),ref:optionInputRef,tone:errors.option?"critical":void 0})}})}),(0,jsx_runtime.jsx)(Column.V,{width:"content",children:(0,jsx_runtime.jsx)(Actions.E,{children:(0,jsx_runtime.jsx)(Button.$n,{onClick:handleSubmit(values=>{var _optionInputRef$curre;setOptionList([...options,{text:values.option,value:values.option,preferredIndicator:!1}]),reset(),null===(_optionInputRef$curre=optionInputRef.current)||void 0===_optionInputRef$curre||_optionInputRef$curre.focus()}),children:"Add"})})})]}),null!==(_errors$option=errors.option)&&void 0!==_errors$option&&_errors$option.message?(0,jsx_runtime.jsx)(FieldMessage.i,{id:"questionnaireBuilderAddOptionMessage",message:errors.option.message,tone:"critical"}):null]}),(0,jsx_runtime.jsx)(Stack.B,{space:"small",children:options.map((_ref5,index)=>{let{text,preferredIndicator}=_ref5;return(0,jsx_runtime.jsxs)(react.Fragment,{children:[index>0?_Divider||(_Divider=(0,jsx_runtime.jsx)(Divider.c,{})):null,(0,jsx_runtime.jsx)(DisplayOption,{text,preferredIndicator,setPreferred,removeItem:(itemText=text,()=>{const itemIndex=options.findIndex(_ref3=>{let{text}=_ref3;return text===itemText}),{beforeItem,afterItem}=SelectOptions_splitArrayAt(options,itemIndex);setOptionList([...beforeItem,...afterItem])})})]},text);var itemText})})]})},QuestionInputFields=_ref=>{let{questionType,state}=_ref;return(0,jsx_runtime.jsxs)(Stack.B,{space:"large",children:[(0,jsx_runtime.jsx)(TextField.A,{id:"questionnaireBuilderQuestionHtml",label:"Question",message:state.questionText.error,onChange:event=>state.questionText.set(event.currentTarget.value),onClear:()=>state.questionText.set(""),value:state.questionText.value,tone:state.questionText.error?"critical":void 0}),["SingleSelect","MultiSelect"].includes(questionType)&&(0,jsx_runtime.jsx)(SelectOptions,{options:state.options.value,setOptionList:state.options.set})]})};var NewQuestionForm_Button;const NewQuestionForm_resolver=createResolver((values,errors)=>{var _values$responseChoic;values.questionType?"FreeText"===values.questionType&&null!==(_values$responseChoic=values.responseChoice)&&void 0!==_values$responseChoic&&_values$responseChoic.length?errors.questionType={type:"validate",message:"Omit any response options"}:"FreeText"!==values.questionType&&(!values.responseChoice||values.responseChoice.length<2)&&(errors.questionType={type:"validate",message:"Provide at least two response options"}):errors.questionType={type:"required",message:"Select a question type"},values.questionHtml||(errors.questionHtml={type:"required",message:"Enter a question"})}),QUESTION_TYPES={FreeText:"Free Text",SingleSelect:"Single Select",MultiSelect:"Multi Select"},NewQuestionForm=_ref=>{var _errors$questionHtml;let{hideForm,initialValues}=_ref;const{clearErrors,control,formState:{errors},handleSubmit,setValue,watch}=(0,index_esm.mN)({defaultValues:{questionHtml:initialValues.questionHtml,questionType:initialValues.responseTypeCode,responseChoice:"responseChoice"in initialValues?initialValues.responseChoice:[]},resolver:NewQuestionForm_resolver}),questionHtmlValue=watch("questionHtml"),questionTypeValue=watch("questionType"),responseChoiceValue=watch("responseChoice");(0,react.useEffect)(()=>clearErrors("questionType"),[clearErrors,responseChoiceValue.length]);const{dispatch}=(0,react.useContext)(StateContext),aggregatedState={questionText:{error:null===(_errors$questionHtml=errors.questionHtml)||void 0===_errors$questionHtml?void 0:_errors$questionHtml.message,value:questionHtmlValue,set:value=>setValue("questionHtml",value,{shouldValidate:!0})},options:{value:responseChoiceValue,set:value=>setValue("responseChoice",value,{shouldValidate:!0})}};return(0,jsx_runtime.jsx)("form",{onSubmit:handleSubmit(_ref2=>{let{questionHtml,questionType,responseChoice}=_ref2;if(questionType){if(initialValues.value){(0,actionCreators.update[questionType])(dispatch)(initialValues.value,questionHtml,responseChoice)}else{(0,actionCreators.add[questionType])(dispatch)(questionHtml,responseChoice)}hideForm()}}),children:(0,jsx_runtime.jsxs)(Stack.B,{space:"large",children:[(0,jsx_runtime.jsx)(Box.l,{children:(0,jsx_runtime.jsxs)(Heading.D,{level:"3",children:[initialValues.value?"Edit":"New"," question"]})}),(0,jsx_runtime.jsx)(index_esm.xI,{control,defaultValue:initialValues.responseTypeCode,name:"questionType",render:_ref3=>{var _errors$questionType;let{field}=_ref3;return(0,jsx_runtime.jsx)(Dropdown.m,{...field,id:field.name,label:"Type",message:null===(_errors$questionType=errors.questionType)||void 0===_errors$questionType?void 0:_errors$questionType.message,onChange:event=>field.onChange(event.currentTarget.value),placeholder:"Select a question type",tone:errors.questionType?"critical":void 0,value:questionTypeValue??"",children:Object.entries(QUESTION_TYPES).map(_ref4=>{let[value,label]=_ref4;return(0,jsx_runtime.jsx)("option",{value,children:label},value)})})}}),questionTypeValue?(0,jsx_runtime.jsx)(QuestionInputFields,{questionType:questionTypeValue,state:aggregatedState}):null,(0,jsx_runtime.jsx)(Box.l,{children:(0,jsx_runtime.jsxs)(Actions.E,{children:[NewQuestionForm_Button||(NewQuestionForm_Button=(0,jsx_runtime.jsx)(Button.$n,{type:"submit",children:"Save"})),(0,jsx_runtime.jsx)(Button.$n,{onClick:hideForm,variant:"transparent",children:"Cancel"})]})})]})})};var _IconEdit,_IconDelete,OverflowMenu=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/OverflowMenu/OverflowMenu.mjs"),MenuItem=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/MenuItem/MenuItem.mjs"),IconEdit=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/icons/IconEdit/IconEdit.mjs"),IconDelete=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/icons/IconDelete/IconDelete.mjs");const QuestionEntryMenu=_ref=>{let{onClickEdit,onClickDelete}=_ref;return(0,jsx_runtime.jsxs)(OverflowMenu.o,{label:"Options",children:[(0,jsx_runtime.jsx)(MenuItem.D,{icon:_IconEdit||(_IconEdit=(0,jsx_runtime.jsx)(IconEdit.G,{})),onClick:onClickEdit,children:"Edit"}),(0,jsx_runtime.jsx)(MenuItem.D,{icon:_IconDelete||(_IconDelete=(0,jsx_runtime.jsx)(IconDelete.x,{})),onClick:onClickDelete,children:"Delete"})]})};var PrivacyConsentEntry_Text;const components_PrivacyConsentEntry=_ref=>{let{privacyConsent}=_ref;const{dispatch}=(0,react.useContext)(StateContext),[showEditForm,setShowEditForm]=(0,react.useState)(!1);return showEditForm?(0,jsx_runtime.jsx)(NewPrivacyConsentForm,{hideForm:()=>setShowEditForm(!1),initialValues:privacyConsent}):(0,jsx_runtime.jsxs)(Columns.e,{alignY:"center",space:"small",children:[(0,jsx_runtime.jsx)(Column.V,{children:(0,jsx_runtime.jsxs)(Stack.B,{space:"small",children:[PrivacyConsentEntry_Text||(PrivacyConsentEntry_Text=(0,jsx_runtime.jsx)(Text.E,{size:"large",children:"Privacy consent"})),(0,jsx_runtime.jsx)(Text.E,{tone:"secondary",size:"small",children:privacyConsent.descriptionHtml??privacyConsent.privacyPolicyUrl.url})]})}),(0,jsx_runtime.jsx)(Column.V,{width:"content",children:(0,jsx_runtime.jsx)(QuestionEntryMenu,{onClickDelete:(questionToDelete=privacyConsent,()=>{actionCreators.delete(dispatch)(questionToDelete.value)}),onClickEdit:()=>{setShowEditForm(!0)}})})]});var questionToDelete},questionTypeDisplayNames={FreeText:"Free text",SingleSelect:"Single select",MultiSelect:"Multi select"},components_QuestionListEntry=_ref=>{let{question}=_ref;const{dispatch}=(0,react.useContext)(StateContext),[showEditForm,setShowEditForm]=(0,react.useState)(!1);return showEditForm?(0,jsx_runtime.jsx)(NewQuestionForm,{hideForm:()=>setShowEditForm(!1),initialValues:question}):(0,jsx_runtime.jsxs)(Columns.e,{alignY:"center",space:"small",children:[(0,jsx_runtime.jsx)(Column.V,{children:(0,jsx_runtime.jsxs)(Stack.B,{space:"small",children:[(0,jsx_runtime.jsx)(Text.E,{size:"large",children:question.questionHtml}),(0,jsx_runtime.jsx)(Text.E,{tone:"secondary",size:"small",children:questionTypeDisplayNames[question.responseTypeCode]})]})}),(0,jsx_runtime.jsx)(Column.V,{width:"content",children:(0,jsx_runtime.jsx)(QuestionEntryMenu,{onClickDelete:(questionToDelete=question,()=>{actionCreators.delete(dispatch)(questionToDelete.value)}),onClickEdit:()=>{setShowEditForm(!0)}})})]});var questionToDelete};var _Columns,_Columns2,_Alert;const FormBuilder=_ref=>{var _Text,_Text2;let{externalFormState,onChange}=_ref;const blankQuestionFormValues={value:"",responseTypeCode:"",responseChoice:[],questionHtml:""},blankPrivacyConsentFormValues={value:"",privacyPolicyUrl:{url:""},descriptionHtml:""},[showQuestionForm,setShowQuestionForm]=(0,react.useState)(!1),[showPrivacyConsentForm,setShowPrivacyConsentForm]=(0,react.useState)(!1),[state,dispatch]=(0,react.useReducer)(formBuilderStateReducer,externalFormState||[]);(0,react.useEffect)(()=>{if(externalFormState){(0,actionCreators.import)(dispatch)(externalFormState)}},[externalFormState]),(0,react.useEffect)(()=>{onChange&&onChange(state)},[state]);const onClickAddQuestion=event=>{event.preventDefault(),setShowQuestionForm(!0)},onClickAddPrivacyConsent=event=>{event.preventDefault(),setShowPrivacyConsentForm(!0)};return(0,jsx_runtime.jsx)(StateContext.Provider,{value:{dispatch,state},children:(0,jsx_runtime.jsxs)(Stack.B,{space:"large",children:[state.map(component=>(component=>"Question"===component.componentTypeCode?(0,jsx_runtime.jsx)(components_QuestionListEntry,{question:component},component.value):null)(component)),showQuestionForm?(0,jsx_runtime.jsx)(NewQuestionForm,{hideForm:()=>setShowQuestionForm(!1),initialValues:blankQuestionFormValues},"newQuestionForm"):state.length<constants.M&&(_Text||(_Text=(0,jsx_runtime.jsx)(Text.E,{children:(0,jsx_runtime.jsx)(TextLinkButton.W,{onClick:onClickAddQuestion,children:_Columns||(_Columns=(0,jsx_runtime.jsxs)(Columns.e,{alignY:"center",space:"small",children:[(0,jsx_runtime.jsx)(Column.V,{children:"Add a question"}),(0,jsx_runtime.jsx)(Column.V,{width:"content",children:(0,jsx_runtime.jsx)(IconAdd.x,{})})]}))})},"questionCard"))),(()=>{const privacyComponent=state.find(fc=>"PrivacyConsent"===fc.componentTypeCode);return void 0!==privacyComponent?(0,jsx_runtime.jsx)(components_PrivacyConsentEntry,{privacyConsent:privacyComponent},privacyComponent.value):showPrivacyConsentForm?(0,jsx_runtime.jsx)(NewPrivacyConsentForm,{hideForm:()=>setShowPrivacyConsentForm(!1),initialValues:blankPrivacyConsentFormValues},"newPrivacyConsentForm"):state.length<constants.M&&(_Text2||(_Text2=(0,jsx_runtime.jsx)(Text.E,{children:(0,jsx_runtime.jsx)(TextLinkButton.W,{onClick:onClickAddPrivacyConsent,children:_Columns2||(_Columns2=(0,jsx_runtime.jsxs)(Columns.e,{alignY:"center",space:"small",children:[(0,jsx_runtime.jsx)(Column.V,{children:"Add a privacy consent"}),(0,jsx_runtime.jsx)(Column.V,{width:"content",children:(0,jsx_runtime.jsx)(IconAdd.x,{})})]}))})},"privacyConsentCard")))})(),state.length===constants.M&&(_Alert||(_Alert=(0,jsx_runtime.jsx)(Alert.F,{children:(0,jsx_runtime.jsx)(Text.E,{children:"Max number of components reached"})})))]})})};var QuestionnaireBuilder_Divider,_Heading;const RoundedCard=_ref=>{let{children}=_ref;return(0,jsx_runtime.jsx)(Card.Z,{roundedAbove:"mobile",children})},QuestionnaireBuilder_stories={args:{hirerId:"seekAnzPublicTest:organization:seek:93WyyF1h",wrapper:void 0},argTypes:{wrapper:{control:{type:"radio"},mapping:{undefined:void 0,card:"card",custom:_ref=>{let{children}=_ref;return(0,jsx_runtime.jsx)(Box.l,{background:"promoteLight",borderRadius:"xlarge",boxShadow:"small",padding:"gutter",children})}},options:["undefined","card","custom"]}},component:_ref2=>{let{wrapper,hirerId,graphqlInput,onChange,showGraphqlOutput}=_ref2;const[formBuilderState,setFormBuilderState]=(0,react.useState)([]);(0,react.useEffect)(()=>{graphqlInput&&setFormBuilderState((graphqlInput=>graphqlInput.map(component=>"PrivacyConsent"===component.componentTypeCode?component.privacyConsent:component.question))(graphqlInput))},[graphqlInput]),(0,react.useEffect)(()=>{onChange&&onChange((0,QuestionnaireQueryOutput.n)(formBuilderState,hirerId))},[formBuilderState,hirerId]);const Wrapper=(0,react.useMemo)(()=>{switch(wrapper){case"card":return RoundedCard;case void 0:return react.Fragment;default:return wrapper}},[wrapper]);return(0,jsx_runtime.jsxs)(Stack.B,{space:"large",children:[(0,jsx_runtime.jsxs)(Columns.e,{collapseBelow:"tablet",space:"large",children:[(0,jsx_runtime.jsx)(Column.V,{width:"1/2",children:(0,jsx_runtime.jsx)(Wrapper,{children:(0,jsx_runtime.jsx)(FormBuilder,{externalFormState:formBuilderState,onChange:setFormBuilderState})})}),formBuilderState.length?(0,jsx_runtime.jsx)(Column.V,{children:(0,jsx_runtime.jsx)(Wrapper,{children:(0,jsx_runtime.jsx)(QuestionnaireForm,{components:formBuilderState,type:"Form"})})}):null]}),showGraphqlOutput?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[QuestionnaireBuilder_Divider||(QuestionnaireBuilder_Divider=(0,jsx_runtime.jsx)(Divider.c,{})),(0,jsx_runtime.jsx)(Wrapper,{children:(0,jsx_runtime.jsxs)(Stack.B,{space:"large",children:[_Heading||(_Heading=(0,jsx_runtime.jsx)(Heading.D,{level:"3",children:"GraphQL output"})),(0,jsx_runtime.jsx)(QuestionnaireQueryOutput.h,{components:formBuilderState,hirerId})]})})]}):null]})},title:"Job Posting/Questionnaires/QuestionnaireBuilder"},QuestionnaireBuilder_stories_QuestionnaireBuilder={}},"./lib/components/QuestionnaireQueryOutput/QuestionnaireQueryOutput.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>QuestionnaireQueryOutput,n:()=>convertComponentsToMutationVariables});var _Text,_Text2,_RadioItem,_RadioItem2,_Stack,braid_design_system__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/RadioGroup/RadioGroup.mjs"),braid_design_system__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/RadioGroup/RadioItem.mjs"),braid_design_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Stack/Stack.mjs"),braid_design_system__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/Text/Text.mjs"),braid_design_system__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../node_modules/.pnpm/braid-design-system@33.12.1_@types+react@18.3.25_babel-plugin-macros@3.1.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/braid-design-system/dist/lib/components/TextLink/TextLink.mjs"),react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../node_modules/.pnpm/react@18.3.1/node_modules/react/index.js"),scoobie__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../node_modules/.pnpm/scoobie@21.0.1_babel-plugin-macros@3.1.0_braid-design-system@33.12.1_@types+react@18.3._95914d0dbf848e51874dc1ae06db369b/node_modules/scoobie/src/components/CodeBlock.tsx"),_private_questionnaires_constants__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./lib/private/questionnaires/constants.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js");const graphqlMutation="\nmutation($input: CreateApplicationQuestionnaireInput!) {\n  createApplicationQuestionnaire(input: $input) {\n    applicationQuestionnaire {\n      id {\n        value\n      }\n    }\n  }\n}".trim(),validateComponents=components=>{if(0===components.length||components.length>_private_questionnaires_constants__WEBPACK_IMPORTED_MODULE_7__.M)return!1;return!(components.filter(fc=>"PrivacyConsent"===fc.componentTypeCode).length>1)},convertComponentsToMutationVariables=(components,hirerId)=>({variables:{input:{applicationQuestionnaire:{hirerId,components:components.map(component=>"Question"===component.componentTypeCode?{componentTypeCode:"Question",question:component}:{componentTypeCode:"PrivacyConsent",privacyConsent:component})}}},valid:validateComponents(components)}),renderVariablesPane=(components,hirerId)=>{if(components.length>0){const{variables}=convertComponentsToMutationVariables(components,hirerId),variablesString=JSON.stringify(variables,null,2);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(braid_design_system__WEBPACK_IMPORTED_MODULE_2__.B,{space:"medium",children:[_Text||(_Text=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(braid_design_system__WEBPACK_IMPORTED_MODULE_3__.E,{children:"For the variables of the mutation, use:"})),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(scoobie__WEBPACK_IMPORTED_MODULE_6__.N,{label:"Request Variables",language:"json",children:variablesString})]})}return _Text2||(_Text2=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(braid_design_system__WEBPACK_IMPORTED_MODULE_3__.E,{children:"You need to add some questions first."}))},QuestionnaireQueryOutput=_ref=>{let{components,hirerId}=_ref;const[visiblePane,setVisiblePane]=(0,react__WEBPACK_IMPORTED_MODULE_5__.useState)("variables");return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(braid_design_system__WEBPACK_IMPORTED_MODULE_2__.B,{space:"large",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(braid_design_system__WEBPACK_IMPORTED_MODULE_0__.z,{"aria-label":"GraphQL query",id:"graphql-query-renderer-pane",onChange:event=>setVisiblePane(event.currentTarget.value),value:visiblePane,children:[_RadioItem||(_RadioItem=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(braid_design_system__WEBPACK_IMPORTED_MODULE_1__.h,{label:"Variables",value:"variables"})),_RadioItem2||(_RadioItem2=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(braid_design_system__WEBPACK_IMPORTED_MODULE_1__.h,{label:"Mutation",value:"mutation"}))]}),"mutation"===visiblePane&&(_Stack||(_Stack=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(braid_design_system__WEBPACK_IMPORTED_MODULE_2__.B,{space:"medium",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(braid_design_system__WEBPACK_IMPORTED_MODULE_3__.E,{children:["To generate the form you’ve built, you’ll need to send a mutation to the"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(braid_design_system__WEBPACK_IMPORTED_MODULE_4__.Yq,{href:"https://graphql.seek.com/graphql",target:"_blank",children:"SEEK API"}),". It will look something like this, although the response fields you require are up to you."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(scoobie__WEBPACK_IMPORTED_MODULE_6__.N,{label:"Request Body",language:"graphql",children:graphqlMutation})]}))),"variables"===visiblePane&&renderVariablesPane(components,hirerId)]})}},"./lib/private/questionnaires/constants.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M:()=>MAX_NUMBER_OF_COMPONENTS});const MAX_NUMBER_OF_COMPONENTS=100}}]);